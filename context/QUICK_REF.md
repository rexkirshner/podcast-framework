# Quick Reference

**Auto-generated by `/save-full`** - Do not edit manually

---

## Project: Strange Water Podcast Framework

**Current:** Phase 2c - Production Operations | **Session:** 19 | **Progress:** 75%

## Tech Stack

- **Framework:** Astro 5.1.1 with SSR + Static Hybrid
- **Language:** TypeScript (strict mode)
- **Database:** Sanity CMS (headless)
- **Hosting:** Cloudflare Pages (migrated from Netlify 2025-10-09)
- **Email:** Resend (transactional), ConvertKit (newsletter)
- **Analytics:** Google Analytics 4
- **Testing:** Vitest (40 passing tests)

## URLs

- **Production:** https://strangewater.xyz (Cloudflare Pages)
- **Sanity Studio:** https://strangewaterpodcast.sanity.studio
- **Repository:** https://github.com/rexkirshner/podcast-framework
- **Local Dev:** http://localhost:4321

## Current Focus

**Phase:** Phase 2c - Production Operations & Hosting Portability
**Status:** ✅ Cloudflare Migration Complete | ✅ All Features Working

**Active Tasks:**
1. Production validation (test all features on Cloudflare)
2. Hosting cleanup (decommission Netlify if stable)
3. Context documentation (auto-generating QUICK_REF.md)

**Next Priority:** Continue Phase 2a feature development (transcripts, search, platform links)

## Quick Commands

```bash
# Development
npm run dev              # Start Astro dev server (localhost:4321)
npm run dev:sanity       # Start Sanity Studio (localhost:3333)

# Build & Deploy
npm run build            # Build for production
npm run preview          # Preview production build locally

# Sanity Data Management
npm run import:episodes  # Import episodes from RSS feed
npm run init:theme       # Initialize/update theme in Sanity
npm run upload:photos    # Upload guest photos to Sanity

# Testing
npm test                 # Run all tests (40 passing)
npm run test:watch       # Run tests in watch mode
```

## Context Navigation

- **Orientation:** `context/CONTEXT.md` - Project setup, architecture, methodology
- **Current Status:** `context/STATUS.md` - Current state, active tasks, blockers
- **Decision Log:** `context/DECISIONS.md` - Technical decisions with rationale
- **Session History:** `context/SESSIONS.md` - Comprehensive work log (19 sessions)
- **Claude Pointer:** `context/CLAUDE.md` - Claude Code entry point

## Key Architecture Points

**Hosting Abstraction Layer:**
- Location: `src/lib/hosting-adapter.ts`
- Purpose: Platform-agnostic environment variables, service config, error logging
- Benefit: Cloudflare migration took 4 hours instead of 31 hours (93% effort reduction)

**Serverless Functions:**
- Contribute form: `/api/contribute` (Cloudflare Pages Function)
- Newsletter signup: `/api/newsletter-subscribe` (Cloudflare Pages Function)
- Business logic: `src/server/services/` (portable across all platforms)

**Content Management:**
- 69 episodes, 72 guests, 65 guest photos
- CMS-driven theming (colors, fonts, layout)
- Build-time data fetching with 5-min cache TTL

## Recent Milestones

**Session 19 (2025-10-09):**
- ✅ Cloudflare Pages migration complete
- ✅ All serverless functions migrated to API routes
- ✅ Email configuration fixed
- ✅ Git push protocol enforced

**Session 18 (2025-10-08):**
- ✅ Code review complete (Grade: A)
- ✅ Claude Context System feedback synthesized (1,238 lines)

**Session 17 (2025-10-08):**
- ✅ Hosting abstraction refactor complete (Sprint 1 & 2)
- ✅ Production deployment at strangewater.xyz
- ✅ Comprehensive hosting migration analysis created

## Code Quality

- **Overall Grade:** A+ (96-98%)
- **Critical Issues:** 0 ✅
- **Build Status:** Success, zero errors ✅
- **Test Coverage:** 40 passing tests ✅
- **TypeScript:** Strict mode enabled ✅

## Critical Protocols

⚠️ **GIT PUSH PERMISSION:** NEVER push to GitHub without explicit user permission
- **Workflow:** Commit freely, ALWAYS ask before push
- **Rationale:** Gives user control over deployment timing
- **Documented:** `context/claude-context-feedback.md:94-196`

## Hosting Migration Status

- [x] **Phase 0:** Analyze dependencies and create strategy (✅ Session 17)
- [x] **Sprint 1:** Extract business logic (✅ Session 17)
- [x] **Sprint 2:** Add provider adapters (✅ Session 17)
- [x] **Phase 3:** Cloudflare Pages migration (✅ Session 19)
- [ ] **Phase 4 (Optional):** Upstash Redis for rate limiting (if needed at scale)

**Achievement:** Migration effort reduced from 31 hours → 4 hours (93% reduction)

---

**Last Updated:** 2025-10-09 21:45 (Session 19)
**Next Session:** Production validation, then feature development (transcripts/search/platform links)
